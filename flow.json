[
    {
        "id": "a1856de285adc81c",
        "type": "tab",
        "label": "backend",
        "disabled": true,
        "info": "",
        "env": []
    },
    {
        "id": "23c53d604e3f87b7",
        "type": "tab",
        "label": "frontend",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "88b4181fcd4a9d1b",
        "type": "natural-language-understanding",
        "z": "a1856de285adc81c",
        "name": "",
        "categories": true,
        "limitcategories": "3",
        "classifications": false,
        "classifications-model": "8",
        "concepts": false,
        "maxconcepts": "8",
        "doc-emotion": true,
        "doc-emotion-target": "",
        "doc-sentiment": false,
        "doc-sentiment-target": "",
        "entity": false,
        "entity-emotion": false,
        "entity-sentiment": false,
        "maxentities": "50",
        "keyword": false,
        "keyword-emotion": false,
        "keyword-sentiment": false,
        "maxkeywords": "50",
        "metadata": false,
        "relation": false,
        "semantic": false,
        "semantic-entities": false,
        "semantic-keywords": false,
        "maxsemantics": "50",
        "limittextcharacters": "0",
        "syntax": false,
        "syntax-sentences": false,
        "syntax-tokens-lemma": false,
        "syntax-tokens-pos": false,
        "service-endpoint": "https://api.au-syd.natural-language-understanding.watson.cloud.ibm.com/instances/45b0a5cf-9c3f-400c-b8e2-ea5fb84dcaac",
        "x": 820,
        "y": 1160,
        "wires": [
            [
                "ba642fe0bc8b060d",
                "60cd4a6a6e24b04d"
            ]
        ]
    },
    {
        "id": "a98ce99f0bdc684a",
        "type": "watson-translator",
        "z": "a1856de285adc81c",
        "name": "",
        "action": "translate",
        "basemodel": "ar-en",
        "domain": "general",
        "srclang": "zh-TW",
        "destlang": "en",
        "apikey": "8XjrcLsoZzhHTj6yBMILGvFXvrH4D5LgN2lX7B9Sj2r-",
        "custom": "",
        "domainhidden": "general",
        "srclanghidden": "zh-TW",
        "destlanghidden": "en",
        "basemodelhidden": "ar-en",
        "customhidden": "",
        "filetype": "forcedglossary",
        "trainid": "",
        "lgparams2": true,
        "service-endpoint": "https://api.au-syd.language-translator.watson.cloud.ibm.com/instances/faeb5936-8fb1-4a25-a8a2-413f0c21e2e9",
        "x": 870,
        "y": 1100,
        "wires": [
            [
                "0b92e83ff9e82315"
            ]
        ]
    },
    {
        "id": "1d7cf7e02f055541",
        "type": "http in",
        "z": "a1856de285adc81c",
        "name": "GetEmail",
        "url": "getEmails/:limit",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 440,
        "y": 600,
        "wires": [
            [
                "1c821decd0cab5ce"
            ]
        ]
    },
    {
        "id": "1c821decd0cab5ce",
        "type": "change",
        "z": "a1856de285adc81c",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "req.params.limit",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 640,
        "y": 580,
        "wires": [
            [
                "9626f8d6b8b70935"
            ]
        ]
    },
    {
        "id": "9626f8d6b8b70935",
        "type": "function",
        "z": "a1856de285adc81c",
        "name": "defaultLimit",
        "func": "if (msg.payload == null) {\n    msg.payload = \"5\";\n}\nmsg.payload = Number(msg.payload);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 630,
        "y": 620,
        "wires": [
            [
                "b230d9fbcb9f5803"
            ]
        ]
    },
    {
        "id": "b230d9fbcb9f5803",
        "type": "http request",
        "z": "a1856de285adc81c",
        "name": "",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "https://api.nylas.com/messages?in=inbox&limit={{{payload}}}",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "bearer",
        "senderr": false,
        "headers": [
            {
                "keyType": "other",
                "keyValue": "Accept",
                "valueType": "other",
                "valueValue": "application/json"
            },
            {
                "keyType": "other",
                "keyValue": "Content-Type",
                "valueType": "other",
                "valueValue": "application/json"
            }
        ],
        "x": 630,
        "y": 660,
        "wires": [
            [
                "dbf28c3dc62e4a72",
                "fdd0abe6457e564f"
            ]
        ]
    },
    {
        "id": "f8ad8ac83a2e2e71",
        "type": "split",
        "z": "a1856de285adc81c",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 410,
        "y": 840,
        "wires": [
            [
                "24a154ad01e1ea86"
            ]
        ]
    },
    {
        "id": "24a154ad01e1ea86",
        "type": "function",
        "z": "a1856de285adc81c",
        "name": "convertDateFormat",
        "func": "msg.payload.date = new Date(msg.payload.date * 1000).toLocaleString();\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 880,
        "wires": [
            [
                "51de12f8cefcffbd",
                "675cf8ba76568019"
            ]
        ]
    },
    {
        "id": "75f277e4dd35be43",
        "type": "join",
        "z": "a1856de285adc81c",
        "name": "",
        "mode": "auto",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": true,
        "timeout": "",
        "count": "",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 1810,
        "y": 840,
        "wires": [
            [
                "73ad1e12c9c44ff4"
            ]
        ]
    },
    {
        "id": "73ad1e12c9c44ff4",
        "type": "template",
        "z": "a1856de285adc81c",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<html>\n   <head>\n       <script src=\"https://cdn.tailwindcss.com\"></script>\n   </head>\n<body>\n<h1 class=\"font-black\" style=\"text-align:center\">Inbox</h2>\n<table class=\"table-auto\">\n   <tr>\n       <th>Date</th>\n       <th>From (Name)</th>\n       <th>From (Email)</th>\n       <th>Subject</th>\n       <th>Snippet</th>\n       <th>Subject(Translated)</th>\n       <th>Subject(Snippet)</th>\n       <th>Feature</th>\n       <th>Score</th>\n   </tr>\n   {{#payload}}\n   <tr>\n   <td>\n   {{date}}\n   </td>\n   <td>\n   {{from.0.name}}\n   </td>\n   <td>\n   {{from.0.email}}\n   </td>   \n   <td>\n   {{subject}}\n   </td>   \n   <td>\n   {{snippet}}\n   </td>\n   <td>\n   {{translatedSnippet.subject}}\n   </td>\n   <td>\n   {{translatedSnippet.snippet}}\n   </td>\n   <td>\n   {{features.categories.0.label}}\n   </td>  \n   <td>\n   {{features.categories.0.score}}\n   </td>\n\n   </tr>\n   {{/payload}}\n</table> \n</body>\n</html>",
        "output": "str",
        "x": 1980,
        "y": 760,
        "wires": [
            [
                "dd3b9427027ce47b",
                "4bf6e6d943e2a839"
            ]
        ]
    },
    {
        "id": "dd3b9427027ce47b",
        "type": "http response",
        "z": "a1856de285adc81c",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 2210,
        "y": 720,
        "wires": []
    },
    {
        "id": "e30bc83193dec4d2",
        "type": "http in",
        "z": "a1856de285adc81c",
        "name": "GetEmailWithoutLimit ",
        "url": "getEmails",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 400,
        "y": 560,
        "wires": [
            [
                "1c821decd0cab5ce"
            ]
        ]
    },
    {
        "id": "dbf28c3dc62e4a72",
        "type": "switch",
        "z": "a1856de285adc81c",
        "name": "",
        "property": "payload.length",
        "propertyType": "msg",
        "rules": [
            {
                "t": "lte",
                "v": "0",
                "vt": "str"
            },
            {
                "t": "gt",
                "v": "0",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 610,
        "y": 700,
        "wires": [
            [
                "9e311bdab8cb8b7d"
            ],
            [
                "f8ad8ac83a2e2e71"
            ]
        ]
    },
    {
        "id": "80f93557777c3fd0",
        "type": "function",
        "z": "a1856de285adc81c",
        "name": "combineResult",
        "func": "var translateResult = msg.payload.translate;\nvar nluResult = msg.features;\n\nmsg.payload = msg.originalPayload;\nmsg.payload.features = nluResult;\nmsg.payload.translatedSnippet = translateResult;\nmsg.parts = msg.originalParts;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1620,
        "y": 1120,
        "wires": [
            [
                "75f277e4dd35be43",
                "1b0835c685acc337"
            ]
        ]
    },
    {
        "id": "51de12f8cefcffbd",
        "type": "function",
        "z": "a1856de285adc81c",
        "name": "createEmailObj",
        "func": "// Backup original payload and parts\nmsg.originalPayload = msg.payload;\nmsg.originalParts = msg.parts;\n\nvar cleanedSnippet = msg.payload.snippet.replace(/[\\u3000-\\u303F\\uFF01-\\uFF0F\\uFF1A-\\uFF20\\uFF3B-\\uFF40\\uFFE0-\\uFFE5]/g, \"\");\n\n// Create Email Contant\nvar emailContant = {\n    subject: msg.payload.subject,\n    snippet: cleanedSnippet\n};\n\nmsg.payload = emailContant;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 700,
        "y": 920,
        "wires": [
            [
                "deb544e5c4cc4de6"
            ]
        ]
    },
    {
        "id": "deb544e5c4cc4de6",
        "type": "delay",
        "z": "a1856de285adc81c",
        "name": "",
        "pauseType": "rate",
        "timeout": "2",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "2",
        "rateUnits": "second",
        "randomFirst": "4",
        "randomLast": "8",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 320,
        "y": 1100,
        "wires": [
            [
                "6c993d439a83e59c",
                "708c582edf540f20",
                "52a79e17999144ed"
            ]
        ]
    },
    {
        "id": "b2f0157696fb1e72",
        "type": "join",
        "z": "a1856de285adc81c",
        "name": "",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "2",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 1450,
        "y": 1120,
        "wires": [
            [
                "80f93557777c3fd0",
                "f39e33e9e798823c"
            ]
        ]
    },
    {
        "id": "6a52d483948ef285",
        "type": "change",
        "z": "a1856de285adc81c",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "features",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1260,
        "y": 1160,
        "wires": [
            [
                "b2f0157696fb1e72"
            ]
        ]
    },
    {
        "id": "ba642fe0bc8b060d",
        "type": "function",
        "z": "a1856de285adc81c",
        "name": "setTopicForJoin",
        "func": "msg.topic = \"NLU\"\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1080,
        "y": 1160,
        "wires": [
            [
                "6a52d483948ef285"
            ]
        ]
    },
    {
        "id": "36756cb6fffbb684",
        "type": "function",
        "z": "a1856de285adc81c",
        "name": "setTopicForJoin",
        "func": "msg.topic = \"translate\"\nmsg.complete = true\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1240,
        "y": 1080,
        "wires": [
            [
                "b2f0157696fb1e72"
            ]
        ]
    },
    {
        "id": "4725f68a6b9adab4",
        "type": "function",
        "z": "a1856de285adc81c",
        "name": "getSubject",
        "func": "msg.topic = \"subject\"\nmsg.payload = msg.payload.subject\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 690,
        "y": 1040,
        "wires": [
            [
                "1a0efa7045b72291"
            ]
        ]
    },
    {
        "id": "6c993d439a83e59c",
        "type": "function",
        "z": "a1856de285adc81c",
        "name": "getSnippet",
        "func": "msg.topic = \"snippet\"\nmsg.payload = msg.payload.snippet\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 690,
        "y": 1100,
        "wires": [
            [
                "a98ce99f0bdc684a"
            ]
        ]
    },
    {
        "id": "1a0efa7045b72291",
        "type": "watson-translator",
        "z": "a1856de285adc81c",
        "name": "",
        "action": "translate",
        "basemodel": "ar-en",
        "domain": "general",
        "srclang": "zh-TW",
        "destlang": "en",
        "apikey": "8XjrcLsoZzhHTj6yBMILGvFXvrH4D5LgN2lX7B9Sj2r-",
        "custom": "",
        "domainhidden": "general",
        "srclanghidden": "zh-TW",
        "destlanghidden": "en",
        "basemodelhidden": "ar-en",
        "customhidden": "",
        "filetype": "forcedglossary",
        "trainid": "",
        "lgparams2": true,
        "service-endpoint": "https://api.au-syd.language-translator.watson.cloud.ibm.com/instances/faeb5936-8fb1-4a25-a8a2-413f0c21e2e9",
        "x": 870,
        "y": 1040,
        "wires": [
            [
                "0b92e83ff9e82315"
            ]
        ]
    },
    {
        "id": "0b92e83ff9e82315",
        "type": "join",
        "z": "a1856de285adc81c",
        "name": "",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "2",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 1070,
        "y": 1080,
        "wires": [
            [
                "36756cb6fffbb684"
            ]
        ]
    },
    {
        "id": "675cf8ba76568019",
        "type": "debug",
        "z": "a1856de285adc81c",
        "name": "debugMsg",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 890,
        "y": 880,
        "wires": []
    },
    {
        "id": "52a79e17999144ed",
        "type": "function",
        "z": "a1856de285adc81c",
        "name": "json2Str",
        "func": "msg.payload = JSON.stringify(msg.payload)\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 600,
        "y": 1160,
        "wires": [
            [
                "88b4181fcd4a9d1b"
            ]
        ]
    },
    {
        "id": "708c582edf540f20",
        "type": "delay",
        "z": "a1856de285adc81c",
        "name": "",
        "pauseType": "rate",
        "timeout": "2",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "4",
        "randomLast": "8",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 530,
        "y": 1040,
        "wires": [
            [
                "4725f68a6b9adab4"
            ]
        ]
    },
    {
        "id": "4bf6e6d943e2a839",
        "type": "debug",
        "z": "a1856de285adc81c",
        "name": "outputTemplate",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2040,
        "y": 1240,
        "wires": []
    },
    {
        "id": "1b0835c685acc337",
        "type": "debug",
        "z": "a1856de285adc81c",
        "name": "checkCombine",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1660,
        "y": 1240,
        "wires": []
    },
    {
        "id": "f39e33e9e798823c",
        "type": "debug",
        "z": "a1856de285adc81c",
        "name": "afterDataJoin",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1420,
        "y": 1240,
        "wires": []
    },
    {
        "id": "60cd4a6a6e24b04d",
        "type": "debug",
        "z": "a1856de285adc81c",
        "name": "check nlu result",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 870,
        "y": 1240,
        "wires": []
    },
    {
        "id": "9e311bdab8cb8b7d",
        "type": "template",
        "z": "a1856de285adc81c",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "You got no email : {{payload}} !",
        "output": "str",
        "x": 1980,
        "y": 700,
        "wires": [
            [
                "dd3b9427027ce47b"
            ]
        ]
    },
    {
        "id": "fdd0abe6457e564f",
        "type": "debug",
        "z": "a1856de285adc81c",
        "name": "Nylas Response",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 900,
        "y": 620,
        "wires": []
    }
]